# TinkoffOnlinePaymentExample
Решение для подключения онлайн-платежей к сайту через Тинькофф

!!! Данная версия является предрелизной и содержит ряд неудобств в настройке frontend-части, связанных с необходимостью копировать каталоги и править HTML (описание ниже). В следующей версии данные недочеты будут устранены.

1. Загрузите на ваш SQL-сервер структуру таблиц sys_product и sys_pay из каталога backend/sql

2. Введите в таблицу sys_product список продаваемых на сайте продуктов

Поле product_name - Название продукта
Поле product_price - цена продукта (руб.)
Поле product_basement - Базовая часть цены, независимая от количества заказанных продуктов. Условно, покупатель заказывает изготовление двух уникальных амулетов по цене 6000 рублей за каждый амулет и 800 рублей - за доставку любого количества амулетов. В таком случае, в product_price вводится цена = 6000, в product_basement - 800. В этом случае при заказе одного амулета итоговая цена за изготовление и доставку составит 6800; за два амулета - 12800; за три амулета - 18800 и т.д. Расчет цены проводится на стороне фронтенда. Если не используется, значение product_basement=0
Поле product_status - позволяет фильтровать продукты по актуальности. Значения: 1 - в продаже, 0 - снят с продажи
Поле product_form_version - указатель на версию клиентской формы для создания платежа. Для текущей сборки = 1.1 по умолчанию.

3. Данные в таблицу sys_pay будут вноситься автоматичеки при формировании заказов пользователем, для данной таблицы необходимо просто загрузить структуру.

4. Загрузите скрипты из каталога backend/api на ваш PHP-сервер

5. В файл backend/api/1.0/__db.php укажите значение переменных:

$db_host="АДРЕС ВАШЕГО MYSQL-сервера";
$db_user="Имя пользователя MySQL";
$db_pass="Пароль пользователя MySQL";
$db_name="База данных, открываемая по умолчанию";

6. Опубликуйте содержимое каталога frontend на любом веб-сервере. Рекомендуется использовать CDN

7. В данном релизе в каталоге /1.1./ необходимо создавать платежные формы для каждого продукта, в каталогах с именем каталога = ID продукта в таблице sys_product. Для примера представлен каталог 1 для продукта с PRODUCT_ID = 1. Вы можете скопировать каталог, переименовав его в соответствии с нужным ID и сверстать необходимый дизайн. Данная опция сделана для возможности кастомизации платежных интерфейсов для каждого продукта.

!!! В следующей версии будут представлены универсальные формы с гибкой настройкой, без необходимости копировать каталоги !!!

8. В файле bank.html замените YOUR_TERMINAL_KEY на ключ терминала, который вам предоставит банк Тинькофф. Значение PRODUCT_PRICE и PRODUCT_NAME замените на цену и название вашего продукта

Для значения Amount укажите цену продукта, умноженную на 100

!!! В следующей версии форм будет убрана необходимость менять значения в HTML !!!


9. В файле bank.js замените BACKEND_URL на URL-адрес вашего PHP-сервера

10. Вызывайте платежную форму с вашего сайта по ссылке вида  https://YOUR_WEBSITE_URL/PayInit/1.0?product_id=YOUR_PRODUCT_ID
